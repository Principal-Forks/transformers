{
  "pv": {
    "name": "Qwen2-VL Real Architecture (Code-Derived)",
    "version": "1.0.0",
    "nodeTypes": {
      "component": {
        "shape": "rounded"
      }
    },
    "edgeTypes": {
      "uses": {
        "style": "solid",
        "color": "#10b981",
        "width": 2,
        "directed": true
      },
      "processes": {
        "style": "solid",
        "color": "#06b6d4",
        "width": 2,
        "directed": true
      },
      "extends": {
        "style": "dashed",
        "color": "#ef4444",
        "width": 2,
        "directed": true
      },
      "configures": {
        "style": "dashed",
        "color": "#fbbf24",
        "width": 2,
        "directed": true
      },
      "encodes": {
        "style": "solid",
        "color": "#06b6d4",
        "width": 2,
        "directed": true
      },
      "generates": {
        "style": "solid",
        "color": "#06b6d4",
        "width": 2,
        "directed": true
      }
    }
  },
  "nodes": [
    {
      "id": "user_input",
      "type": "text",
      "x": 450,
      "y": -100,
      "width": 300,
      "height": 60,
      "color": "2",
      "text": "User Input (images/videos + text)",
      "pv": {
        "nodeType": "component",
        "shape": "rounded",
        "fill": "#ff9800",
        "stroke": "#ff9800"
      }
    },
    {
      "id": "processor",
      "type": "text",
      "x": 451,
      "y": 73,
      "width": 300,
      "height": 90,
      "color": "5",
      "text": "Qwen2VLProcessor\nprocessing_qwen2_vl.py:48\nInherits: ProcessorMixin",
      "pv": {
        "nodeType": "component",
        "shape": "rounded",
        "fill": "#06b6d4",
        "stroke": "#06b6d4"
      }
    },
    {
      "id": "image_processor",
      "type": "text",
      "x": 100,
      "y": 320,
      "width": 280,
      "height": 100,
      "color": "5",
      "text": "Qwen2VLImageProcessor\nimage_processing_qwen2_vl.py:105\nInherits: BaseImageProcessor\n• smart_resize()\n• resize, rescale, normalize",
      "pv": {
        "nodeType": "component",
        "shape": "rounded",
        "fill": "#06b6d4",
        "stroke": "#06b6d4"
      }
    },
    {
      "id": "tokenizer",
      "type": "text",
      "x": 920,
      "y": 320,
      "width": 250,
      "height": 100,
      "color": "5",
      "text": "Qwen2TokenizerFast\n(external)\n• Tokenizes text\n• Handles special tokens",
      "pv": {
        "nodeType": "component",
        "shape": "rounded",
        "fill": "#06b6d4",
        "stroke": "#06b6d4"
      }
    },
    {
      "id": "video_processor",
      "type": "text",
      "x": 420,
      "y": 320,
      "width": 260,
      "height": 100,
      "color": "5",
      "text": "Qwen2VLVideoProcessor\nvideo_processing_qwen2_vl.py\n• Frame extraction\n• Temporal processing",
      "pv": {
        "nodeType": "component",
        "shape": "rounded",
        "fill": "#06b6d4",
        "stroke": "#06b6d4"
      }
    },
    {
      "id": "config",
      "type": "text",
      "x": -200,
      "y": 600,
      "width": 250,
      "height": 120,
      "color": "3",
      "text": "Qwen2VLConfig\nconfiguration_qwen2_vl.py:239\n• vision_config\n• text_config\n• token IDs",
      "pv": {
        "nodeType": "component",
        "shape": "rounded",
        "fill": "#fbbf24",
        "stroke": "#fbbf24"
      }
    },
    {
      "id": "for_conditional_gen",
      "type": "text",
      "x": 450,
      "y": 464,
      "width": 400,
      "height": 120,
      "color": "4",
      "text": "Qwen2VLForConditionalGeneration\nmodeling_qwen2_vl.py:1263\nInherits: Qwen2VLPreTrainedModel, GenerationMixin\n• forward() - main entry point\n• lm_head - output projection",
      "pv": {
        "nodeType": "component",
        "shape": "rounded",
        "fill": "#10b981",
        "stroke": "#10b981"
      }
    },
    {
      "id": "qwen2vl_model",
      "type": "text",
      "x": 450,
      "y": 680,
      "width": 400,
      "height": 120,
      "color": "4",
      "text": "Qwen2VLModel\nmodeling_qwen2_vl.py:925\n• self.visual (vision encoder)\n• self.language_model (text decoder)\n• get_rope_index() - 3D position encoding",
      "pv": {
        "nodeType": "component",
        "shape": "rounded",
        "fill": "#10b981",
        "stroke": "#10b981"
      }
    },
    {
      "id": "vision_transformer",
      "type": "text",
      "x": 100,
      "y": 880,
      "width": 300,
      "height": 180,
      "color": "4",
      "text": "Qwen2VisionTransformer\nmodeling_qwen2_vl.py:669\nInherits: Qwen2VLPreTrainedModel\n\n• PatchEmbed:257 - patch tokenization\n• VisionRotaryEmbedding:243\n• Qwen2VLVisionBlock:432 (×32)\n  - VisionAttention:349\n  - VisionMlp:299\n• PatchMerger:283 - spatial merge",
      "pv": {
        "nodeType": "component",
        "shape": "rounded",
        "fill": "#10b981",
        "stroke": "#10b981"
      }
    },
    {
      "id": "text_model",
      "type": "text",
      "x": 450,
      "y": 880,
      "width": 300,
      "height": 180,
      "color": "4",
      "text": "Qwen2VLTextModel\nmodeling_qwen2_vl.py:768\nInherits: Qwen2VLPreTrainedModel\n\n• embed_tokens - embeddings\n• Qwen2VLDecoderLayer:570 (×80)\n  - Qwen2VLAttention:478 (GQA)\n  - Qwen2MLP:462 (SwiGLU)\n• Qwen2RMSNorm - normalization",
      "pv": {
        "nodeType": "component",
        "shape": "rounded",
        "fill": "#10b981",
        "stroke": "#10b981"
      }
    },
    {
      "id": "multimodal_fusion",
      "type": "text",
      "x": 262,
      "y": 1028,
      "width": 280,
      "height": 180,
      "color": "6",
      "text": "Multimodal Fusion\nIn Qwen2VLModel\n\n• Vision embeddings merged\n• Text embeddings\n• Combined via position IDs\n• 3D RoPE for vision\n• 1D RoPE for text",
      "pv": {
        "nodeType": "component",
        "shape": "rounded",
        "fill": "#a855f7",
        "stroke": "#a855f7"
      }
    },
    {
      "id": "generation_mixin",
      "type": "text",
      "x": 925,
      "y": 587,
      "width": 260,
      "height": 120,
      "color": "6",
      "text": "GenerationMixin\n(inherited)\n• generate()\n• beam search\n• sampling strategies",
      "pv": {
        "nodeType": "component",
        "shape": "rounded",
        "fill": "#a855f7",
        "stroke": "#a855f7"
      }
    },
    {
      "id": "model_output",
      "type": "text",
      "x": 452,
      "y": 1178,
      "width": 400,
      "height": 100,
      "color": "2",
      "text": "Qwen2VLCausalLMOutputWithPast\nmodeling_qwen2_vl.py:86\n• logits, loss\n• past_key_values (KV cache)\n• rope_deltas",
      "pv": {
        "nodeType": "component",
        "shape": "rounded",
        "fill": "#ff9800",
        "stroke": "#ff9800"
      }
    },
    {
      "id": "pretrained_model",
      "type": "text",
      "x": 100,
      "y": 600,
      "width": 250,
      "height": 100,
      "color": "1",
      "text": "PreTrainedModel\n(transformers base)\n• from_pretrained()\n• save_pretrained()",
      "pv": {
        "nodeType": "component",
        "shape": "rounded",
        "fill": "#ef4444",
        "stroke": "#ef4444"
      }
    },
    {
      "id": "image_utils",
      "type": "text",
      "x": -10,
      "y": 464,
      "width": 220,
      "height": 100,
      "color": "5",
      "text": "image_utils.py\nimage_transforms.py\n• resize, rescale\n• normalize, pad\n• convert_to_rgb",
      "pv": {
        "nodeType": "component",
        "shape": "rounded",
        "fill": "#06b6d4",
        "stroke": "#06b6d4"
      }
    }
  ],
  "edges": [
    {
      "id": "e1",
      "fromNode": "user_input",
      "toNode": "processor",
      "color": "5",
      "pv": {
        "edgeType": "processes"
      }
    },
    {
      "id": "e2",
      "fromNode": "processor",
      "toNode": "image_processor",
      "color": "4",
      "pv": {
        "edgeType": "uses"
      }
    },
    {
      "id": "e3",
      "fromNode": "processor",
      "toNode": "video_processor",
      "color": "4",
      "pv": {
        "edgeType": "uses"
      }
    },
    {
      "id": "e4",
      "fromNode": "processor",
      "toNode": "tokenizer",
      "color": "4",
      "pv": {
        "edgeType": "uses"
      }
    },
    {
      "id": "e5",
      "fromNode": "image_processor",
      "toNode": "image_utils",
      "color": "4",
      "pv": {
        "edgeType": "uses"
      }
    },
    {
      "id": "e6",
      "fromNode": "processor",
      "toNode": "for_conditional_gen",
      "color": "5",
      "pv": {
        "edgeType": "processes"
      }
    },
    {
      "id": "e7",
      "fromNode": "for_conditional_gen",
      "toNode": "qwen2vl_model",
      "color": "4",
      "pv": {
        "edgeType": "uses"
      }
    },
    {
      "id": "e8",
      "fromNode": "qwen2vl_model",
      "toNode": "vision_transformer",
      "color": "4",
      "pv": {
        "edgeType": "uses"
      }
    },
    {
      "id": "e9",
      "fromNode": "qwen2vl_model",
      "toNode": "text_model",
      "color": "4",
      "pv": {
        "edgeType": "uses"
      }
    },
    {
      "id": "e10",
      "fromNode": "vision_transformer",
      "toNode": "multimodal_fusion",
      "color": "5",
      "pv": {
        "edgeType": "encodes"
      }
    },
    {
      "id": "e11",
      "fromNode": "text_model",
      "toNode": "multimodal_fusion",
      "color": "5",
      "pv": {
        "edgeType": "encodes"
      }
    },
    {
      "id": "e12",
      "fromNode": "multimodal_fusion",
      "toNode": "model_output",
      "color": "5",
      "pv": {
        "edgeType": "generates"
      }
    },
    {
      "id": "e13",
      "fromNode": "for_conditional_gen",
      "toNode": "generation_mixin",
      "color": "1",
      "pv": {
        "edgeType": "extends"
      }
    },
    {
      "id": "e14",
      "fromNode": "for_conditional_gen",
      "toNode": "pretrained_model",
      "color": "1",
      "pv": {
        "edgeType": "extends"
      }
    },
    {
      "id": "e15",
      "fromNode": "config",
      "toNode": "for_conditional_gen",
      "color": "3",
      "pv": {
        "edgeType": "configures"
      }
    },
    {
      "id": "e16",
      "fromNode": "qwen2vl_model",
      "toNode": "model_output",
      "color": "5",
      "pv": {
        "edgeType": "generates"
      }
    }
  ]
}